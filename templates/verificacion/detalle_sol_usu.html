<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Fashi Template">
    <meta name="keywords" content="Fashi, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Inicio</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&display=swap" rel="stylesheet">



</head>

<body onload="traerDetalleSol();">
    <!-- Page Preloder -->
 
    {% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/bootstrap.min.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/font-awesome.min.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/themify-icons.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/elegant-icons.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/owl.carousel.min.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/nice-select.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/jquery-ui.min.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/slicknav.min.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/modal.css') }}"/>
    {% endblock %}
<header class="header-section">
        
        <div class="container">
            <div class="inner-header">
                <div class="row">                 
                    <div class="col-lg-10 col-md-10">                      
                        <div class="logo">
                            <a href="./index.html">                               
                                <h3>
                                    <img id="logo-wide" src="/assets/img/Universidad_de_Lima_logo_2.png" alt="Ulima" height = "62px">
                                    <b>SISTEMA DE GESTIÓN DE OBJETOS PERDIDOS</b>
                                </h3>
                                <img id="logo-narrow" src="/assets/img/Universidad_de_Lima_logo_2.png" alt="Ulima" height = "62px">
                            </a>
                        </div>
                    </div>
                    <div class="quantity">
                                    
                        <button type="button" class="btn btn-secondary" id="registrar_1" >
                            Logout
                        </button>

                    </div>
                    
                </div>
            </div>
        </div>
   
    </header>

    <div class="nav-item">
        <div class="container">
           
            <header class="header-section">
    
                <div class="nav-item">
                    <div class="container">
                        
                        <nav class="nav-menu mobile-menu">
                            <ul>
                                {% if (session['status'] == 'active') %}
                                {% if (session['rol'] == 1) %} <!--ALUMNO O PROF-->
                                <li id="1"><a href="/inicio">OBJETOS</a></li>
                                {% else %}
                                {% if (session['rol'] == 2) %} <!--JEFE-->
                                <li><a href="/inicio">OBJETOS</a></li>
                                <li id="2"><a href="/register">REGISTRO OBJETOS</a></li>
                                <li><a href="/sol_usu">SOLICITUDES USUARIO</a></li>
                                <li><a href="/sol_usu">SOLICITUD DE DONACIÓN</a></li>
                                
                                {% else %}
                                {% if (session['rol'] == 3) %} <!---->
                                <li id="3"><a href="/inicio">OBJETOS</a></li>
                                <li><a href="/register">REGISTRO OBJETOS</a></li>
                                <li><a href="/sol_usu">SOLICITUDES USUARIO</a></li>
                                
                                {% else %}
                                {% if (session['rol'] == 4) %}
                                <li id="4"><a href="/inicio">OBJETOS</a></li>
                                <li><a href="/register">REGISTRO OBJETOS</a></li>
                                
                                {% else %}
                                <li id="5"><a href="/inicio">OBJETOS</a></li>
                                <li><a href="/registro">SOLICITUD DE DONACIÓN</a></li>
                                
                                {% endif %}
                                {% endif %}
                                {% endif %}
                                {% endif %}
                                {% else %}
                                <a href="/logout">Ingresar</a>
                                {% endif %}

                            </ul>
                        </nav>
                        <div id="mobile-menu-wrap"></div>
                    </div>
                </div>
            </header>
        </div>
    </div>
    <!-- Header End -->

    <!-- Breadcrumb Section Begin -->
    
    <!-- Breadcrumb Section Begin -->

    <!-- Product Shop Section Begin -->
    <section class="product-shop spad page-details">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-12">
                    <div class="row" id="soliPadre">
                        <div class="col-lg-2">
                         
                        </div>
                        <div class="col-lg-8" id="solicitudUsuario">
                            <div class="product-details">
                                <div class="pd-title">
                                    <h3>Solicitud de usuario</h3>
                                    <p><i>Por favor, compare la descripción enviada por el usuario con las características especiales del objeto para aceptar o rechazar la solicitud.</i></p> 
                                </div>
                                
                                <div class="pd-desc" id="detalleSoli">
                                    <ul class="pd-tags">
                                        
                                    </ul>
                                </div>
                            </div>
                            <div class="quantity">
                                <a href="#" class="primary-btn pd-cart" id="rechazar" style="background-color:rgb(109, 105, 105);" onclick="myfunction2()">RECHAZAR</a>
                                <a href="#" class="primary-btn pd-cart" id="abrir" onclick="abrir_1()">ACEPTAR</a>
                            </div>
                        </div> 
                        <div class="col-lg-2">
                         
                        </div>  
                    </div>
                </div>

                <div id="miModal" class="modal">
                    <div class="flex" id="flex">
                        <div class="contenido-modal">
                            <div class="modal-body" align="center">
                                <span class="close" id="close">&times;</span>
                                <br>
                                <br>
                                <h4 >¿Está seguro de que</h4>
                                <h4 id="cambio" >desea aceptar la </h4>
                                <h4>solicitud?</h4>
                                <br>
                                <br>
                                <form action="/sol_usu/actualizar" method="post">
                                <button type="button" id="rechazar" class="btn btn-secondary" onclick="myfunction()";>Cancelar </button>
                                <button type="submit" class="btn btn-primary" onclick="actualizarTabla(event)">OK</button>
                                </form>
                            </div>  
                        </div>
                    </div>
                </div>

                <div id="miModal4" class="modal">
                    <div class="flex" id="flex">
                        <div class="contenido-modal">
                            <div class="modal-body" align="center">
                                <span class="close" id="close4" onclick="cerrar_final()";>&times;</span>
                                <br>
                                <h4>Envío exitoso</h4>
                                <br>
                                <img src="{{ url_for('static', filename='assets/img/affection.jpeg')}}" width="150px" height="150px"/></div>
                            </div>
                       </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="footer-left">
                        <div class="footer-widget">
                            <h5>Oficina de Objetos Perdidos</h5>
                        </div>
                        <ul>
                            <li>Ubicación: Edificio V, Oficina 303</li>
                            <li>Teléfono: 4376767 anexo 31495</li>
                            <li>Email: zvillena@ulima.edu.pe</li>
                        </ul>
                        <div class="footer-social">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-instagram"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-pinterest"></i></a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 offset-lg-1">
                    <div class="footer-widget">
                        <h5>Información</h5>
                        <ul>
                            <li><a href="#">Sobre Nosotros</a></li>
                            <li><a href="#">Servicios</a></li>
                            <li><a href="#">Horarios</a></li>
                            
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2">
                    <div class="footer-widget">
                        <h5>Mi cuenta</h5>
                        <ul>
                            <li><a href="#">Registrados</a></li>
                            <li><a href="#">Solicitudes</a></li>
                            <li><a href="#">Términos de uso</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="newslatter-item">
                        <h5>Centro de ayuda</h5>
                        <p>Preguntas frecuentes</p>
                        <p>Contacto</p>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright-reserved">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="copyright-text">
                                   
    </footer>                    
    <!-- Footer Section End-->
    <script>
        const queryString = window.location.search;
        console.log(queryString);
        const urlParams = new URLSearchParams(queryString);
        const soliId = urlParams.get('soliId')
        console.log(soliId);

        function traerDetalleSol() {
            const xhttp = new XMLHttpRequest();
            xhttp.open('GET', '/sol_usu/detalle?soliId=' + soliId, true);
            xhttp.onreadystatechange = function () {
                if (xhttp.readyState == 4) {
                    switch (xhttp.status) {
                        case 200:
                            myFunction(JSON.parse(xhttp.responseText));
                            break;
                    }
                }
            }
            xhttp.send();
        }

        function myFunction(datos) {
            var variable = document.getElementById("detalleSoli");
            var a = variable.childNodes[1].id;
            let miNodo = document.createElement('ul');
            miNodo.classList.add('pd-tags');

            for (let item of datos) {
                let miNodoLiTitle = document.createElement('li');
                let miNodoTitle = document.createElement('span');
                miNodoTitle.textContent = "NRO. SOLICITUD: "; 
                let nro_solicitud = item.nro_solicitud;

                let miNodoLiFechaEnv = document.createElement('li');
                let miNodoFechaEnv = document.createElement('span');
                miNodoFechaEnv.textContent = "FECHA DE ENVÍO DE LA SOLICITUD: ";
                let fecha_envio = item.fecha_envio;

                let miNodoLiNomObj = document.createElement('li');
                let miNodoNomObj = document.createElement('span');
                miNodoNomObj.textContent = "OBJETO SOLICITADO: ";
                let nom_objeto = item.nom_objeto;

                let miNodoLiLugar = document.createElement('li');
                let miNodoLugar = document.createElement('span');
                miNodoLugar.textContent = "LUGAR: ";
                let lugar;
                if(String(item.lugar) != 'PARQUE CENTRAL' && String(item.lugar) != 'ZUM'){
                    lugar = "Pabellón " + item.lugar;
                } else{
                    lugar = item.lugar;
                }

                let miNodoLiDescripcion = document.createElement('li');
                let miNodoDescripcion = document.createElement('span');
                miNodoDescripcion.textContent = "DESCRIPCIÓN ENVIADA POR EL USUARIO: ";
                let descripcion = item.descripcion;
                
                let miNodoLiCaractEsp = document.createElement('li');
                let miNodoCaractEsp = document.createElement('span');
                miNodoCaractEsp.textContent = "CARACTERÍSTICAS DEL OBJETO: ";
                let caract_esp = item.caract_esp;
                

                miNodoLiTitle.appendChild(miNodoTitle);
                miNodoLiFechaEnv.appendChild(miNodoFechaEnv);
                miNodoLiNomObj.appendChild(miNodoNomObj);
                miNodoLiLugar.appendChild(miNodoLugar);
                miNodoLiDescripcion.appendChild(miNodoDescripcion);
                miNodoLiCaractEsp.appendChild(miNodoCaractEsp);

                miNodo.appendChild(miNodoLiTitle).append(nro_solicitud);
                miNodo.appendChild(miNodoLiFechaEnv).append(fecha_envio);
                miNodo.appendChild(miNodoLiNomObj).append(nom_objeto);
                miNodo.appendChild(miNodoLiLugar).append(lugar);
                miNodo.appendChild(miNodoLiDescripcion).append(descripcion);
                miNodo.appendChild(miNodoLiCaractEsp).append(caract_esp);

                document.getElementById("detalleSoli").appendChild(miNodo);
                
            }
        }

        var estado;

        var btnOK = document.getElementById("close4");
        btnOK.addEventListener("click",function(){
            var bloque = document.getElementById("solicitudUsuario");
            bloque.innerHTML = '<p class="text-center">La solicitud fue respondida. Haga clic <a href="/sol_usu"><u>aquí</u></a> para ver más solicitudes.<p>';
        })

        var btnRechazar = document.getElementById("rechazar");
        btnRechazar.addEventListener("click", function(){
            estado = "RECHAZADA";
            console.log(estado);
        })

        var btnAceptar = document.getElementById("abrir");
        btnAceptar.addEventListener("click", function(){
            estado = "ACEPTADA"
            console.log(estado);
        })

        console.log(estado);

        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();

        today = yyyy + '-' + mm + '-' + dd;
        console.log(today);

        function actualizarTabla(e) {
            e.preventDefault();
            const xhttp = new XMLHttpRequest();
            xhttp.open('GET', '/sol_usu/actualizar?soliId=' + soliId + "&estado=" + estado + "&fechaRpta=" + today, true);
            console.log('corrio actualizartabla');
            xhttp.send();
            ventana();
        }
    </script>
    <script>
        $("#registrar_1").click(function () {
            Swal.fire({
                title: '¿Está seguro de que desea cerrar sesión?',
                showCancelButton: true,
                confirmButtonColor: '#e77b3c',
                cancelButtonColor: 'grey',
                confirmButtonText: 'OK'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/logout";
                }
            })
        });
    </script>
    {% block js %}
    <script src="{{ url_for('static', filename='assets/js/jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery-ui.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.countdown.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.nice-select.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.zoom.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.dd.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.slicknav.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/owl.carousel.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/modal_sol_usu.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/verificar_sol.js') }}"></script>
    {% endblock %}
   